## Codebase Patterns

- GitLab API client is injected into the Model via NewModel() constructor
- Use async command pattern for API calls: define Msg type (e.g., commentsLoadedMsg), create command function (e.g., loadCommentsCmd), handle in Update()
- State enums (DetailSection, ViewMode, IssueFilterState) need String() method for display
- Tab key behavior is context-dependent: toggles sections in detail view, switches views otherwise
- Check view-specific state (len(m.items) > 0 && m.selectedItem < len(m.items)) before showing section-specific UI
- gitlab.Note.Author is a struct, not a pointer - check empty string instead of nil
- GitLab SDK types (gitlab.Issue, gitlab.Note) are used in model, but local gitlab package provides API wrapper
- Import aliasing needed when importing both gitlab SDK and local pkg/gitlab package (use `gl` alias for local package)

## 2026-01-17 - US-007
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Added DetailSection enum (DescriptionSection, CommentsSection) with String() method
- Added commentsLoadedMsg, commentsLoadedErrMsg message types for async loading
- Added selectedComments []*gitlab.Note field to Model
- Added gitlabClient interface to Model for dependency injection (allows mocking)
- Created loadCommentsCmd() function to fetch comments via API
- Updated Tab key handler: toggles detail sections in IssuesView, switches views otherwise
- Updated Enter key handler in IssuesView: loads comments when issue selected, resets to DescriptionSection
- Updated renderDetailsPanel: shows description or comments based on detailSection state
- Updated status bar: shows current view (Description/Comments) and comment count
- Modified main.go: create GitLab client and inject into Model

**Learnings for future iterations:**
- When adding new detail sections, follow the DetailSection pattern: create enum type with String() method
- API calls should be async using tea.Cmd pattern: define Msg type, create command function, handle in Update()
- GitLab client must be created in main.go and injected into Model via NewModel()
- When adding gitlab package imports, use aliasing to avoid conflicts with SDK types
- For state-dependent key handlers (like Tab), check context first (currentView + selection state)
- gitlab.Note.Author is a struct, check .Username field directly (not nil)
- Loading state: set isLoading=true before command, set isLoading=false in message handler
 - Comment display limit: use maxCommentLines constant and show "+N more" indicator
 - Error handling: use SetError() helper and show error popup via renderErrorPopup()
 ---

## 2026-01-17 - US-008
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Added CreateIssueOptions struct with Title and Description fields
- Added CreateIssue method to Client interface
- Implemented CreateIssue method in client struct: calls gitlab.Issues.CreateIssue with proper options
- Added createIssueErr field to mockClient struct in client_test.go
- Added CreateIssue method to mockClient in client_test.go: returns m.issue, m.createIssueErr

**Learnings for future iterations:**
- Follow established pattern when adding API methods: Options struct → Client interface → client implementation → mock implementation
- GitLab SDK's CreateIssue method takes gitlab.CreateIssueOptions with pointer fields (Title, Description)
- Map local options struct to SDK options struct by checking non-empty values and setting pointers
- Return nil error with wrapped context: fmt.Errorf("context: %w", err)
- Always check for nil responses from API and return descriptive error
- Mock implementation pattern: return mock data from struct fields, allow error injection via error field
---

## 2026-01-17 - US-009
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Added showCreateIssueForm, issueFormTitle, issueFormDesc, issueFormField fields to Model
- Added CreateIssue method to gitlabClient interface in GUI package
- Added issueCreatedMsg and issueCreatedErrMsg message types for async issue creation
- Created createIssueCmd() function to handle async API call
- Updated Update() method to handle create issue form key events:
  - Tab switches between title and description fields
  - Enter switches to next field or submits if at description
  - Ctrl+Enter submits the form
  - Esc cancels the form
  - Regular characters are added to the active field
  - Backspace removes characters from active field
- Added 'c' key handler in IssuesView to open create issue form
- Updated View() method to show create issue form popup when active
- Created renderCreateIssueForm() method to render the form with title and description fields
- Form shows current field indicator (sidebarActive style) and cursor placeholder (_)
- After successful creation, form closes and fields are reset

**Learnings for future iterations:**
- For form state management, use boolean flag (showCreateIssueForm) and check it first in Update/View methods
- Handle text input by checking msg.Type == tea.KeyRunes and msg.Type == tea.KeyBackspace
- Use msg.String() for single-character checks like 'c' but check msg.Type for input handling
- Active field indicator can be implemented by toggling between style assignments based on field state
- Cursor placeholder (_) helps users understand where input will be entered
- Form validation (e.g., required title check) should happen in the submit handler, not during input
- Reset all form fields when closing form (both on cancel and successful submit)
- Async API calls follow pattern: create Msg type, create Cmd function, handle in Update method
- Form rendering should show all fields but highlight the active one with different style
---
